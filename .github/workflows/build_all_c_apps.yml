name: Build all C apps on latest C SDK

on:
  workflow_dispatch:
    inputs:
      sdk_branch:
        type: string
        required: false
        default: ''
  pull_request:

# NOTE : changes made to this file in the context of  this PR will be reverted
#        these are just for the sake of testing the PR

jobs:
  build-docker:
    name: Build ledger-app-builder-lite
    uses: LedgerHQ/ledger-app-workflows/.github/workflows/reusable_docker_deployment.yml@v1
    with:
      app_repository: LedgerHQ/ledger-app-builder
      app_ref: mbr/clang-21
      image_name: ledger-app-builder-lite
      dockerfile_path: lite/Dockerfile
      dry_run: true
      outputs: "type=docker,dest=/tmp/ledger-app-builder-lite.tar"
    secrets:
      token: ${{ secrets.GITHUB_TOKEN }}

  prepare-matrix:
    name: Retrieve C apps
    runs-on: ubuntu-latest
    outputs:
      c_apps: ${{ steps.get_c_apps.outputs.c_apps }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
            python-version: '3.x'
      - name: Install ledgered
        run: pip install ledgered
      - name: Get all C apps
        id: get_c_apps
        run: |
          python .github/workflows/scripts/get_c_apps.py ${{ secrets.GITHUB_TOKEN }}
          echo "c_apps=$(cat c_apps.json)" >> $GITHUB_OUTPUT

  print-matrix:
    needs: [prepare-matrix]
    runs-on: ubuntu-latest
    steps:
      - name: Print matrix
        run: |
          echo "Matrix content: ${{ needs.prepare-matrix.outputs.c_apps }}"

  test-build:
    name: Build for all targets
    needs: [prepare-matrix, build-docker]
    strategy:
      fail-fast: false
      matrix:
        apps: ${{ fromJSON(needs.prepare-matrix.outputs.c_apps) }}
    runs-on: ubuntu-latest

    steps:
      - name: Clone App
        uses: actions/checkout@v4
        with:
          repository: LedgerHQ/${{ matrix.apps.app-name }}
          submodules: recursive
          path: ${{ matrix.apps.app-name }}
      - name: Clone SDK
        uses: actions/checkout@v4
        with:
          path: sdk
          ref: ${{ inputs.sdk_branch }}

      - name: Download Docker image artifact
        uses: actions/download-artifact@v4
        with:
          name: ledger-app-builder-lite
          path: /tmp

      - name: Load Docker image and start build container
        run: |
          LOADED_IMAGE=$(docker load -i /tmp/ledger-app-builder-lite.tar | grep "Loaded image" | head -1 | awk '{print $NF}')
          docker run -d --name builder -v $GITHUB_WORKSPACE:/workspace "$LOADED_IMAGE" sleep infinity
          docker exec builder pip install --break-system-packages ledgered

      - name: Create artifacts directory
        run: mkdir -p $GITHUB_WORKSPACE/artifacts

      - name: Build App for Nano X
        if: contains(matrix.apps.devices, 'nanox')
        continue-on-error: true
        run: |
          docker exec builder bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Nano X' &&
            make clean &&
            make TARGET=nanox BOLOS_SDK=/workspace/sdk
          "
      - name: Collect Nano X binary
        if: contains(matrix.apps.devices, 'nanox')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanox/bin/app.elf \
             artifacts/${{ matrix.apps.app-name }}-nanox.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanox/dbg/app.map \
             artifacts/${{ matrix.apps.app-name }}-nanox.map || true
      - name: Build App for Nano S+
        if: contains(matrix.apps.devices, 'nanos+')
        continue-on-error: true
        run: |
          docker exec builder bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Nano S+' &&
            make clean &&
            make TARGET=nanos2 BOLOS_SDK=/workspace/sdk
          "
      - name: Collect Nano S+ binary
        if: contains(matrix.apps.devices, 'nanos+')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanos2/bin/app.elf \
             artifacts/${{ matrix.apps.app-name }}-nanosp.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanos2/dbg/app.map \
             artifacts/${{ matrix.apps.app-name }}-nanosp.map || true
      - name: Build App for Stax
        if: contains(matrix.apps.devices, 'stax')
        continue-on-error: true
        run: |
          docker exec builder bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Stax' &&
            make clean &&
            make TARGET=stax BOLOS_SDK=/workspace/sdk
          "
      - name: Collect Stax binary
        if: contains(matrix.apps.devices, 'stax')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/stax/bin/app.elf \
             artifacts/${{ matrix.apps.app-name }}-stax.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/stax/dbg/app.map \
             artifacts/${{ matrix.apps.app-name }}-stax.map || true
      - name: Build App for Flex
        if: contains(matrix.apps.devices, 'flex')
        continue-on-error: true
        run: |
          docker exec builder bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Flex' &&
            make clean &&
            make TARGET=flex BOLOS_SDK=/workspace/sdk
          "
      - name: Collect Flex binary
        if: contains(matrix.apps.devices, 'flex')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/flex/bin/app.elf \
             artifacts/${{ matrix.apps.app-name }}-flex.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/flex/dbg/app.map \
             artifacts/${{ matrix.apps.app-name }}-flex.map || true
      - name: Build App for Apex+
        if: contains(matrix.apps.devices, 'apex_p')
        continue-on-error: true
        run: |
          docker exec builder bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Apex+' &&
            make clean &&
            make TARGET=apex_p BOLOS_SDK=/workspace/sdk
          "
      - name: Collect Apex+ binary
        if: contains(matrix.apps.devices, 'apex_p')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/apex_p/bin/app.elf \
             artifacts/${{ matrix.apps.app-name }}-apex_p.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/apex_p/dbg/app.map \
             artifacts/${{ matrix.apps.app-name }}-apex_p.map || true

      - name: Upload app binaries
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.apps.app-name }}-binaries
          path: artifacts/
          if-no-files-found: ignore
          retention-days: 1

      - name: Cleanup
        if: always()
        run: docker rm -f builder || true

  test-build-official:
    name: Build for all targets (official image)
    needs: [prepare-matrix]
    strategy:
      fail-fast: false
      matrix:
        apps: ${{ fromJSON(needs.prepare-matrix.outputs.c_apps) }}
    runs-on: ubuntu-latest

    steps:
      - name: Clone App
        uses: actions/checkout@v4
        with:
          repository: LedgerHQ/${{ matrix.apps.app-name }}
          submodules: recursive
          path: ${{ matrix.apps.app-name }}

      - name: Pull official Docker image and start build container
        run: |
          docker pull ghcr.io/ledgerhq/ledger-app-builder/ledger-app-builder-lite:5.0.2
          docker run -d --name builder-official -v $GITHUB_WORKSPACE:/workspace ghcr.io/ledgerhq/ledger-app-builder/ledger-app-builder-lite:5.0.2 sleep infinity
          docker exec builder-official pip install --break-system-packages ledgered

      - name: Create artifacts directory
        run: mkdir -p $GITHUB_WORKSPACE/artifacts-official

      - name: Build App for Nano X
        if: contains(matrix.apps.devices, 'nanox')
        continue-on-error: true
        run: |
          docker exec builder-official bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Nano X' &&
            make clean &&
            make TARGET=nanox BOLOS_SDK=/opt/nanox-secure-sdk
          "
      - name: Collect Nano X binary
        if: contains(matrix.apps.devices, 'nanox')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanox/bin/app.elf \
             artifacts-official/${{ matrix.apps.app-name }}-nanox.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanox/dbg/app.map \
             artifacts-official/${{ matrix.apps.app-name }}-nanox.map || true
      - name: Build App for Nano S+
        if: contains(matrix.apps.devices, 'nanos+')
        continue-on-error: true
        run: |
          docker exec builder-official bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Nano S+' &&
            make clean &&
            make TARGET=nanos2 BOLOS_SDK=/opt/nanosplus-secure-sdk
          "
      - name: Collect Nano S+ binary
        if: contains(matrix.apps.devices, 'nanos+')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanos2/bin/app.elf \
             artifacts-official/${{ matrix.apps.app-name }}-nanosp.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/nanos2/dbg/app.map \
             artifacts-official/${{ matrix.apps.app-name }}-nanosp.map || true
      - name: Build App for Stax
        if: contains(matrix.apps.devices, 'stax')
        continue-on-error: true
        run: |
          docker exec builder-official bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Stax' &&
            make clean &&
            make TARGET=stax BOLOS_SDK=/opt/stax-secure-sdk
          "
      - name: Collect Stax binary
        if: contains(matrix.apps.devices, 'stax')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/stax/bin/app.elf \
             artifacts-official/${{ matrix.apps.app-name }}-stax.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/stax/dbg/app.map \
             artifacts-official/${{ matrix.apps.app-name }}-stax.map || true
      - name: Build App for Flex
        if: contains(matrix.apps.devices, 'flex')
        continue-on-error: true
        run: |
          docker exec builder-official bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Flex' &&
            make clean &&
            make TARGET=flex BOLOS_SDK=/opt/flex-secure-sdk
          "
      - name: Collect Flex binary
        if: contains(matrix.apps.devices, 'flex')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/flex/bin/app.elf \
             artifacts-official/${{ matrix.apps.app-name }}-flex.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/flex/dbg/app.map \
             artifacts-official/${{ matrix.apps.app-name }}-flex.map || true
      - name: Build App for Apex+
        if: contains(matrix.apps.devices, 'apex_p')
        continue-on-error: true
        run: |
          docker exec builder-official bash -c "
            cd /workspace/${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }} &&
            echo 'Building for Apex+' &&
            make clean &&
            make TARGET=apex_p BOLOS_SDK=/opt/apex-secure-sdk
          "
      - name: Collect Apex+ binary
        if: contains(matrix.apps.devices, 'apex_p')
        run: |
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/apex_p/bin/app.elf \
             artifacts-official/${{ matrix.apps.app-name }}-apex_p.elf || true
          cp ${{ matrix.apps.app-name }}/${{ matrix.apps.build-directory }}/build/apex_p/dbg/app.map \
             artifacts-official/${{ matrix.apps.app-name }}-apex_p.map || true

      - name: Upload app binaries
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.apps.app-name }}-binaries-official
          path: artifacts-official/
          if-no-files-found: ignore
          retention-days: 1

      - name: Cleanup
        if: always()
        run: docker rm -f builder-official || true

  compare-builds:
    name: Compare builds
    needs: [prepare-matrix, test-build, test-build-official]
    if: always()
    strategy:
      fail-fast: false
      matrix:
        apps: ${{ fromJSON(needs.prepare-matrix.outputs.c_apps) }}
    runs-on: ubuntu-latest

    steps:
      - name: Download custom build artifacts
        uses: actions/download-artifact@v4
        with:
          name: ${{ matrix.apps.app-name }}-binaries
          path: custom/
        continue-on-error: true

      - name: Download official build artifacts
        uses: actions/download-artifact@v4
        with:
          name: ${{ matrix.apps.app-name }}-binaries-official
          path: official/
        continue-on-error: true

      - name: Install analysis tools
        run: |
          sudo apt-get update
          sudo apt-get install -y binutils-arm-none-eabi
          wget -q https://github.com/google/bloaty/releases/download/v1.1/bloaty-1.1-linux-x86_64.tar.gz
          tar xf bloaty-1.1-linux-x86_64.tar.gz
          sudo mv bloaty /usr/local/bin/bloaty

      - name: Analyze and compare binaries
        run: |
          APP_NAME="${{ matrix.apps.app-name }}"
          DEVICES="${{ matrix.apps.devices }}"
          
          echo "# Binary Comparison Report: $APP_NAME" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Comparing builds between **clang-14 (official)** and **clang-21 (custom)**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Debug: List available files
          echo "**Available files:**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          ls -la custom/ official/ 2>&1 | head -20 >> $GITHUB_STEP_SUMMARY || echo "No files found" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Create comparison table header
          echo "| Toolchain | Device | Binary Size | .text | .data | .bss | .rodata |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|-------------|-------|-------|------|---------|" >> $GITHUB_STEP_SUMMARY
          
          # Process each device
          for device_key in nanox nanosp stax flex apex_p; do
            OFFICIAL_ELF="official/${APP_NAME}-${device_key}.elf"
            CUSTOM_ELF="custom/${APP_NAME}-${device_key}.elf"
            
            # Skip if neither file exists
            if [ ! -f "$OFFICIAL_ELF" ] && [ ! -f "$CUSTOM_ELF" ]; then
              continue
            fi
            
            # Get device display name
            case $device_key in
              nanox) DEVICE_NAME="Nano X" ;;
              nanosp) DEVICE_NAME="Nano S+" ;;
              stax) DEVICE_NAME="Stax" ;;
              flex) DEVICE_NAME="Flex" ;;
              apex_p) DEVICE_NAME="Apex+" ;;
            esac
            
            # Official build (clang-14)
            if [ -f "$OFFICIAL_ELF" ]; then
              SIZE_OUTPUT=$(arm-none-eabi-size "$OFFICIAL_ELF" 2>&1)
              SIZE_OFF=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $1+$2}')
              TEXT_OFF=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $1}')
              DATA_OFF=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $2}')
              BSS_OFF=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $3}')
              
              # Get rodata from detailed output
              RODATA_OFF=$(arm-none-eabi-size -A "$OFFICIAL_ELF" 2>&1 | grep "^\.rodata" | awk '{print $2}')
              RODATA_OFF=${RODATA_OFF:-0}
              
              echo "| **clang-14** | $DEVICE_NAME | $SIZE_OFF | $TEXT_OFF | $DATA_OFF | $BSS_OFF | $RODATA_OFF |" >> $GITHUB_STEP_SUMMARY
            fi
            
            # Custom build (clang-21)
            if [ -f "$CUSTOM_ELF" ]; then
              SIZE_OUTPUT=$(arm-none-eabi-size "$CUSTOM_ELF" 2>&1)
              SIZE_CUST=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $1+$2}')
              TEXT_CUST=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $1}')
              DATA_CUST=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $2}')
              BSS_CUST=$(echo "$SIZE_OUTPUT" | tail -n1 | awk '{print $3}')
              
              # Get rodata from detailed output
              RODATA_CUST=$(arm-none-eabi-size -A "$CUSTOM_ELF" 2>&1 | grep "^\.rodata" | awk '{print $2}')
              RODATA_CUST=${RODATA_CUST:-0}
              
              echo "| **clang-21** | $DEVICE_NAME | $SIZE_CUST | $TEXT_CUST | $DATA_CUST | $BSS_CUST | $RODATA_CUST |" >> $GITHUB_STEP_SUMMARY
              
              # Calculate difference if both exist
              if [ -f "$OFFICIAL_ELF" ] && [ -n "$SIZE_OFF" ] && [ -n "$SIZE_CUST" ]; then
                DIFF=$((SIZE_CUST - SIZE_OFF))
                if [ $DIFF -gt 0 ]; then
                  DIFF_STR="+$DIFF"
                elif [ $DIFF -lt 0 ]; then
                  DIFF_STR="$DIFF"
                else
                  DIFF_STR="0"
                fi
                if [ $SIZE_OFF -ne 0 ]; then
                  PERCENT=$(awk "BEGIN {printf \"%.2f\", ($DIFF / $SIZE_OFF) * 100}")
                  echo "| _Δ_ | | $DIFF_STR ($PERCENT%) | | | | |" >> $GITHUB_STEP_SUMMARY
                else
                  echo "| _Δ_ | | $DIFF_STR | | | | |" >> $GITHUB_STEP_SUMMARY
                fi
              fi
            fi
            
            # Add spacer row
            echo "| | | | | | | |" >> $GITHUB_STEP_SUMMARY
          done
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Detailed section comparison
        run: |
          cat << 'EOF' > detailed_compare.sh
          #!/bin/bash
          
          APP_NAME="${{ matrix.apps.app-name }}"
          
          echo "## Detailed Section Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          for device_key in nanox nanosp stax flex apex_p; do
            OFFICIAL_ELF="official/${APP_NAME}-${device_key}.elf"
            CUSTOM_ELF="custom/${APP_NAME}-${device_key}.elf"
            
            if [ -f "$OFFICIAL_ELF" ] && [ -f "$CUSTOM_ELF" ]; then
              case $device_key in
                nanox) DEVICE_NAME="Nano X" ;;
                nanosp) DEVICE_NAME="Nano S+" ;;
                stax) DEVICE_NAME="Stax" ;;
                flex) DEVICE_NAME="Flex" ;;
                apex_p) DEVICE_NAME="Apex+" ;;
              esac
              
              echo "### $DEVICE_NAME" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "<details>" >> $GITHUB_STEP_SUMMARY
              echo "<summary>Click to expand section details</summary>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "=== Official (clang-14) ===" >> $GITHUB_STEP_SUMMARY
              arm-none-eabi-size -A "$OFFICIAL_ELF" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "=== Custom (clang-21) ===" >> $GITHUB_STEP_SUMMARY
              arm-none-eabi-size -A "$CUSTOM_ELF" >> $GITHUB_STEP_SUMMARY
              echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "</details>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
            fi
          done
          EOF
          
          chmod +x detailed_compare.sh
          ./detailed_compare.sh

      - name: Generate bloaty diff reports
        run: |
          APP_NAME="${{ matrix.apps.app-name }}"
          mkdir -p bloaty-reports

          for device_key in nanox nanosp stax flex apex_p; do
            OFFICIAL_ELF="official/${APP_NAME}-${device_key}.elf"
            CUSTOM_ELF="custom/${APP_NAME}-${device_key}.elf"

            if [ ! -f "$OFFICIAL_ELF" ] || [ ! -f "$CUSTOM_ELF" ]; then
              continue
            fi

            case $device_key in
              nanox)  DEVICE_NAME="Nano X" ;;
              nanosp) DEVICE_NAME="Nano S+" ;;
              stax)   DEVICE_NAME="Stax" ;;
              flex)   DEVICE_NAME="Flex" ;;
              apex_p) DEVICE_NAME="Apex+" ;;
            esac

            REPORT="bloaty-reports/${APP_NAME}-${device_key}.md"

            {
              echo "# Bloaty diff: ${APP_NAME} — ${DEVICE_NAME}"
              echo ""
              echo "**Baseline:** clang-14 (official image)  "
              echo "**New build:** clang-21 (custom image)  "
              echo "**Generated:** $(date -u '+%Y-%m-%d %H:%M UTC')"
              echo ""
              echo "## By section"
              echo '```'
              bloaty --diff-base="$OFFICIAL_ELF" "$CUSTOM_ELF" \
                -d sections -n 0 2>&1 || echo "(bloaty failed)"
              echo '```'
              echo ""
              echo "## By compile unit"
              echo '```'
              bloaty --diff-base="$OFFICIAL_ELF" "$CUSTOM_ELF" \
                -d compileunits -n 0 2>&1 || echo "(bloaty failed)"
              echo '```'
              echo ""
              echo "## By compile unit → symbol"
              echo '```'
              bloaty --diff-base="$OFFICIAL_ELF" "$CUSTOM_ELF" \
                -d compileunits,symbols -n 0 2>&1 || echo "(bloaty failed)"
              echo '```'
            } > "$REPORT"

            echo "Generated: $REPORT"
          done

      - name: Upload bloaty reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.apps.app-name }}-bloaty-reports
          path: bloaty-reports/
          if-no-files-found: ignore
          retention-days: 7
